<!DOCTYPE html>
<html>
	<head>
		<title>PhyloCanvas</title>

		<meta name="viewport" content="width=device-width" />

		<link rel="stylesheet" href="//brick.a.ssl.fastly.net/Raleway:100,300,400,500,700">
		<link rel="stylesheet" href="/css/phylocanvas.css">
	</head>
	<body>
		<div class="container">
			<h1 class="pageheader"><span class="light">Phylo</span>Canvas <span class="light"> - API</span></h1>
			<nav>
				<ul>
					<li><a href="api.html">API</a></li>
					<li><a href="technical.html">Technical Documentation</a></li>
				</ul>
			</nav>

			<section>
				<h2>PhyloCanvas.Loader</h2>
				<p>Loader Animation in it's own canvas. <i>Deprecated</i></p>
			</section>

			<section>
				<h2>PhyloCanvas.Navigator</h2>
				<p>Overview showing the current view window in relation to the whole tree <i>Incomplete</i></p>
			</section>

			<section class="class">
			<h2>PhyloCanvas.Tree</h2>
			<h3>Config Object</h3>
			<p class="note">To be expanded in v 1.3.0</p>
			<dl>
				<dt>history_collapsed - <i>boolean</i></dt>
					<dd>Is the history initially in the collapsed state</dd>

			</dl>

			<h3>Properties</h3>
				<dl>
					<dt>backColour - <i>bool/function (default : false)</i></dt>
						<dd>
						Possible values:
							<ul>
							<li><strong>false</strong> : the branches are all coloured according to Tree.branchColour</li>
							<li><strong>true</strong> : leaves are coloured according to their .colour property. IF all of an Internal branches
								children are of the same colour the branch takes that colour, otherwise it uses Tree.branchColour</li>
							<li><strong>{string:rgba} function(branch)</strong> : the branch colour is determined by the colour returned by the function.
								Ideally the returned colour should be an RGBA value</li>
							</ul>
						</dd>

					<dt>baseNodeSize - <i>integer</i></dt>
						<dd>The radius of a leaf tip if no other size is specified</dd>

					<dt>branchColour - <i>rgba value</i></dt>
						<dd>The normal colour of the branches </dd>

					<dt>branchScalar - <i>double</i></dt>
						<dd>a multiplier for the branch length to produce the best
						possible definition between branch lengths (branchLength * branchScalar =
						drawnLength) </dd>

					<dt>branches - <i>Object/Dictionary</i></dt>
						<dd>An object containing each branch keyed by it's ID. Internal
						branches without IDs are given generated Ids prefixed with 'pcn',
						the root will typically be 'pcn0'</dd>

					<dt>canvas - <i>HTMLCanvasContext</i></dt>
						<dd>the canvas used to draw the tree</dd>

					<dt>canvasEl - <i>HTMLDivElement</i></dt>
						<dd>Slight misnoma for legacy reasons... the element that
						contains PhyloCanvas. Should normally be a block element</dd>

					<dt>contextMenu - <i>PhyloCanvas.ContextMenu</i></dt>
						<dd>A reference to the context menu object that belongs to this instance</dd>

					 <dt>dragging - <i>boolean</i></dt>
							<dd>has the tree been "picked up" AND moved?</dd>

					<dt>drawn - <i>boolean</i></dt>
						<dd>A variable for internal use the records whether
						the pre-render has run (named for legacy reasons)</dd>

					<dt>font - <i>string</i></dt>
						<dd>The font face to use for tree labels</dd>

					<dt>highlightColour - <i>rgba value</i></dt>
						<dd>The colour highlighted branches change to</dd>

					<dt>hightlightWidth - <i>int (default : 5)</i></dt>
						<dd>How much bigger do highlighted nodes/branches get</dd>

					<dt>hoverLabel - <i>boolean</i></dt>
						<dd>If the labels are turned off, and this is true, show
						the node label when hovering over the node tip.</dd>

					<dt>internalNodesSelectable - <i>boolean</i></dt>
						<dd>Can internal nodes be selected, if false, only leaves
						are selectable</dd>

					<dt>lastId - <i>int</i></dt>
						<dd>The last id returned by the id generator</dd>

					<dt>leaves - <i>PhyloCanvas.Branch[]</i></dt>
						<dd>An array of every node without children, the tips
							of the tree </dd>

					<dt>lineWidth - <i>double (default:1.0)</i></dt>
						<dd>The width of the lines that make up the branches, as
						well as the outline of the nodes</dd>

					<dt>maxBranchLength - <i>double, read only</i></dt>
						<dd>The max branchlength from the root of the tree to
							the furthest tip</dd>

					<dt>offsetx/offsety - <i>int</i></dt>
						<dd>The the position of the diagram origin (0,0)
						relative to the centre of the viewer</dd>

					<dt>origBL - <i>Object</i></dt>
						<dd>The original branch lengths, populated when a
							subtree is drawn </dd>

					<dt>origP - <i>Object</i></dt>
						<dd>The original parent of the new root, populated when a
							subtree is drawn </dd>

					<dt>pickedUp - <i>boolean</i></dt>
						<dd>Is the left mouse button being held down over the
							tree</dd>

					<dt>rightClickZoon - <i>boolean (default : true)</i></dt>
						<dd>Enable zooming the tree by dragging with the right mouse button</dd>

					<dt>selectedColour - <i>rgba value</i></dt>
						<dd>The colour the branch and node change to when selected</dd>

					<dt>selectedNodeSizeIncrease - <i>int (default : 0)</i></dt>
						<dd>How much bigger do selected nodes get</dd>

					<dt>showBootstrap - <i>boolean (default:false)</i></dt>
						<dd>Whether or not to show all the bootstrap confidences</dd>

					<dt>showLabels - <i>boolean (default: true)</i></dt>
						<dd>Whether or not to draw all the leaf labels</dd>

					<dt>textSize - <i>integer</i></dt>
						<dd>The size of the branch labels (in px)</dd>

					<dt>treetype - <i>string (default : radial)</i></dt>
						<dd>which branchRenderer to use, supplied renderers are:
							radial, rectangular, circular, diagonal and hierarchy</dd>

					<dt>root - <i>Branch</i></dt>
						<dd>A reference to the root of the tree</dd>

					<dt>unselectOnClickAway - <i>boolean (default : true)</i></dt>
						<dd>Deselect when the user clicks on somewhere on the canvas
						that isn't the tree</dd>

					<dt>selectedNodes - <i>PhyloCanvas.Branch[]</i></dt>
						<dd>An array of the selected branches</dd>

					<dt>zoom - <i>double</i></dt>
						<dd>The current Zoom level</dd>

				</dl>

			<h3>Functions</h3>
			<dl>
				<dt class="code">AJAX(url, method, params, callback, callbackPars, scope, errorCallback)</dt>
					<dd>Make an AJAX call and pass the data returned to the callback. Used in the load method</dd>

				<dt>addListener(<i>event_name</i>, <i>listener</i>)</dt>
				<dt>on(<i>event_name</i>, <i>listener</i>)</dt>
					<dd>attach a listener to an event from the tree</dd>

				<dt class="code">adjustForPixelRatio()</dt>
					<dd>
						compensate for Retina display/browser zoom
					</dd>

				<dt class="code">branchRenderers (collection : function(Tree, Branch, collapsed))</dt>
					<dd>Functions that enable the drawing of different tree structures. Default
					branchRenderers are radial, rectangular, circular, diagonal, hierarchy </dd>

				<dt>buildLeaves()</dt>
					<dd>Reconstruct the leaves array in the correct order after
						a rotation</dd>

				<dt class="code">clicked(event)</dt>
				<dt class="code">dblclicked(event)</dt>
				<dt class="code">drag(event)</dt>
				<dt class="code">drop()</dt>
				<dt class="code">pickup()</dt>
				<dt class="code">scroll(event)</dt>
					<dd>
						Event handlers for mouse events on the canvas
					</dd>


				<dt class="code">displayLabels()</dt>
					<dd>
						Show the lables on the tree
					</dd>

				<dt class="code">draw(<i>forceRedraw</i>)</dt>
					<dd>
						draw the tree with the settings provided, forceRedraw causes
						the prerenderer to redraw.
					</dd>

				<dt>exportNwk</dt>
					<dd>
						Return the newick string of the currently displayed tree
					</dd>

				<dt class="code">findBranch(<i>pattern</i>)</dt>
					<dd>
						File a branch accoring to the pattern provided (is matched
						against the id using new RegExp(pattern 'i'))
					</dd>

				<dt class="code">fitInPanel()</dt>
					<dd>
						fit the tree within the current canvas panel
					</dd>


				<dt class="code">genId()</dt>
					<dd>
						Generate a node Id prefixed with 'pcn'
					</dd>

				<dt class="code">getBounds()</dt>
					<dd>
						get the overall size of the tree
					</dd>


				<dt>getPngUrl()</dt>
					<dd>
						Get the dataURL for the current view
					</dd>

				<dt class="code">hideLabels()</dt>
					<dd>
						Hide the lables on the tree
					</dd>

				<dt class="code">load(<i>filename/nwkstring</i>,<i>[tree_name]</i>,<i>[format]</i>)</dt>
					<dd>
						<p>Parse a newick or nexus format string and draw the tree</p></p>
						<dl class="arguments">
							<dt>filename (String)</dt>
							<dd>the name of the file you wish to open via AJAX or the NWK or Nexus String</dd>

							<dt>tree_name (String)</dt>
							<dd>If using nexus format, the name of the tree to draw. But default Phylocanvas picks the first tree</dd>

							<dt>format (nexus|newick)</dt>
							<dd>override the parsing algorithm for the string provided</dd>
						</dl>
					</dd>

				<dt>loadCompleted()</dt>
					<dd>Fire the event that signals the load is completed</dd>

				<dt>loadError(<i>message</i>)</dt>
					<dd>Fire the event that signals the load has failed</dd>

				<dt>loadStarted()</dt>
					<dd>Fire the event that signals the load has started</dd>

				<dt>nodeRenderers (Collection : fuction(tree, node))</dt>
					<dd> Render the tip of a leaf. Extensible colletion that includes
						circle, square, triangle and start by default. Rotation and offset of
						the canvas are set so that 0,0 is the tip of the branch.</dd>

				<dt>nodeSelected(nids)</dt>
					<dd>Fire the event that signals nodes have been selected</dd>

				<dt>parseNexus(<i>nexus_string</i>,<i>name</i>)</dt>
				<dt>parseNwk(<i>nwk_string</i>)</dt>
					<dd>Parse a Nexus or nwk formatted string. If using Nexus
					the tree name should be specified, normally these methods are
					invoked from within the load function</dd>

				<dt class="code">prerenderers (collection : function(Tree, forcedDraw))</dt>
					<dd>Functions calculate the structure of the tree before drawing. Default
					pre-renderers are radial, rectangular, circular, diagonal, hierarchy.
					<i>forcedDraw is deprecated and has no effect</i> </dd>

				<dt>redrawFromBranch(<i>node</i>, <i>leafIds</i>)</dt>
					<dd>
						recursively get the IDs of the leaves in a sub-tree, putting the results
						in leafIds
					</dd>

				<dt>redrawFromBranch(<i>node</i>)</dt>
					<dd>
						Redraw a sub-tree from an internal node of a tree.
					</dd>

				<dt>redrawOriginalTree()</dt>
					<dd>
						redraw the tree from it's original root
					</dd>

				<dt>resetTree()</dt>
					<dd>
						Reset the tree ready for the pre-renderers to recalculate
					</dd>

				<dt>resizeToContainer()</dt>
					<dd>Fit the whole widget within it's parent div</dd>


				<dt>rotateBranch(<i>branch</i>)</dt>
					<dd>
						Reverse the order a branch's children are drawn in
					</dd>

				<dt>saveNode(<i>node</i>)</dt>
					<dd>
						Add a node to the tree. Used by the parsers.
					</dd>

				<dt>selectNodes(<i>nodeIds</i>)</dt>
					<dd>Select the nodes specified by node ids (array or comma seperated list).
						<b>N.B.</b> all leaves must be adjacent in the tree</dd>

				<dt>setFont(<i>font</i>)</dt>
					<dd>Change the font for the node labels</dd>

				<dt>setNodeColourAndShape(<i>nodeIds</i>, <i>[colour]</i>, <i>[shape]</i>, <i>[size]</i>, <i>[waiting]</i>)</dt>
					<dd>Change the node colour and/or shape, optional arguments must be replaced
					by null or undefined if subsequent arguments are set
						<dl class="arguments">
							<dt>nodeIds : string or array</dt>
								<dd>the nodes to change</dd>
							<dt>colour : rgba value</dt>
								<dd>the colour to set the nodes too</dd>
							<dt>shape : string</dt>
								<dd>The name of the nodeRenderer</dd>
							<dt>size : int</dt>
								<dd>The node size</dd>
							<dt>waiting : boolean</dt>
								<dd>deprecated</dd>
						</dl>
					</dd>

				<dt>setNodeSize(<i>size</i>)</dt>
					<dd>Set the base size of all the nodes</dd>

				<dt>setRoot(<i>node</i>)</dt>
					<dd>Set the root node of the tree</dd>

				<dt>setTextSize(<i>size</i>)</dt>
					<dd>Set the size of the labels</dd>

				<dt class="code">setTreeType(<i>type</i>)</dt>
					<dd>
						<p>Hide the lables on the tree</p>
						<dl class="arguments">
							<dt>type (String)</dt>
							<dd>
								<p>the name of the type of tree to change to (rectangular, radial, circular, diagonal, hierarchy)</p>
							</dd>
						</dl>
					</dd>

				<dt>setSize(<i>width</i>, <i>height</i>)</dt>
					<dd>Set the size of the tree</dd>

				<dt>setZoom(<i>zoom_level</i>)</dt>
					<dd>Set the zoom level of the tree</dd>

				<dt>toggleLabels()</dt>
					<dd>Toggle the labels on and off</dd>

				<dt>translateClickX(click_x)</dt>
				<dt>translateClickY(click_y)</dt>
					<dd>Take the postion of the click from the browser event
						and turn it into a position relative to the tree</dd>

				<dt>treeTypeChanged(<i>old_type</i>,<i>new_type</i>)</dt>
					<dd>Fire the event that signals the tree type has been changed</dd>
			</dl>

			<a name="tree-events"><h3>Events</h3></a>
			<p>PhyloCanvas exposes a number of events that allow web pages to change according to activity within PhyoCanvas. The API also exposes a couple of helper methods to enable binding of events to the API.</p>
			<h3>Helper Methods</h3>
			<dl>
				<dt>Tree.on(<i>event name</i>, <i>handler</i>)</dt>
				<dt>Tree.addListener(<i>event name</i>, <i>handler</i>)</dt>
					<dd>add the specified <i>handler</i> to the specified <i>event name</i></dd>
				<!--<dt>TODO : Tree.removeListener/Tree.off</dt>-->
			</dl>

			<h3>Events</h3>
			<dl>
				<dt>loading</dt>
					<dd>Fires when the widget starts loading a file via AJAX</dd>

				<dt>loaded</dt>
					<dd>Fires when a tree has completed loading.</dd>

				<dt>error</dt>
					<dd>
						Fires if an error is encountered by the loading or parsing process
						<h4>Properties</h4>
						<dl>
							<dt>message</dt>
								<dd>The Error message</dd>
						</dl>
					</dd>

				<dt>subtree</dt>
					<dd>
						Fires when the user draws a subtree
						<h4>Properties</h4>
						<dl>
							<dt>node</dt>
								<dd>The id of the node chosen as the new root</dd>
						</dl>
					</dd>

				<dt>typechanged</dt>
					<dd>
						Fires when the tree type is changed
						<dl>
							<dt>oldType</dt>
								<dd>The name of the type of tree that was being displayed before the type was changed</dd>

							<dt>newType</dt>
								<dd>The name of the type of tree that the view was changed to</dd>
						</dl>
					</dd>

				<dt>selected</dt>
					<dd>
						Fires when the user selectes node(s)
						<h4>Properties</h4>
						<dl>
							<dt>nodes</dt>
								<dd>An Array of the IDs of selected node</dd>
						</dl>
					</dd>


			</dl>
			</section>

			<section name="api-branch">
				<a name="branch"></a>
				<h2>PhyloCanvas.Branch</h2>

				<h3>Properties</h3>
					<dt>angle</dt>
						<dd>
							The angle (clockwise from horizontal) of the node branch
						</dd>
					<dt>branchLength</dt>
						<dd>
							The relative length of the branch as defined in the nwk/nexus string
						</dd>
					<dt>canvas</dt>
						<dd>
							A reference to the canvas on which the branch is drawn
						</dd>
					<dt>centrex/centrey</dt>
						<dd>
							The position of the end of the node.
						</dd>
					<dt>children</dt>
						<dd>
							The child branches of this branch
						</dd>

					<dt>collapsed</dt>
						<dd>
							Has the branch been collapsed
						</dd>

					<dt>colour</dt>
						<dd>
							The fill colour of the node tip
						</dd>

					<dt>data</dt>
						<dd>
							a custom object that can be used in conjustion with a
							custom noderenderer
						</dd>


					<dt>id</dt>
						<dd>
							The unique identifier for a node, particulary for identifying leaf nodes, this becomes the
							key to <i>Tree.branches</i>
						</dd>

					<dt>interx/interx</dt>
						<dd>
							Used by layouts that align all the nodes at the same distance
							from the root, but needing to show branch lengths (e.g. circular layout);
						</dd>

					<dt>label</dt>
						<dd>
							The label shown next to the node. Blank strings will be displayed, if the label is null (default)
							or undefined the ID is displayed instead
						</dd>

					<dt>leaf</dt>
						<dd>
							True if the branch has no children and is therefore
							a leaf
						</dd>

					<dt>maxChildAngle</dt>
					<dt>minChildAngle</dt>
						<dd>
							The maxim
						</dd>

					<dt>startx</dt>
					<dt>starty</dt>
						<dd>
							The position of the start of the branch (the parent nodes centrex/centrey)
						</dd>

					<dt>totalBranchLength</dt>
						<dd>
							The total distance from the root of the tree to the tip of the branch
						</dd>

					<dt>tree</dt>
						<dd>
							A reference to the tree object that this branch belongs too
						</dd>


				<h3>Functions</h3>
					<dt>addChild(<i>node</i>)</dt>
						<dd>Add a child branch to this branch</dd>

					<dt>clicked(<i>x</i>, <i>y</i>)</dt>
						<dd>see if this branch is the one that has been clicked given the x
						and y coordinates (output from Tree.translateClickX/Y)</dd>

					<dt>collapse()</dt>
						<dd>Collapse this branch</dd>

					<dt>drawLabel()</dt>
						<dd>Draw the label for this branch</dd>

					<dt>drawNode()</dt>
						<dd>draw the coloured tip of this branch</dd>

					<dt>expand()</dt>
						<dd>Expand (uncollapse) the node</dd>

					<dt>getColour()</dt>
						<dd>Get the tip or branch colour of this node depeneding on whether its
						a leaf or an internal node</dd>

					<dt>getChildColours()</dt>
						<dd>return an array of the colours of this childs children</dd>

					<dt>getChildCount()</dt>
						<dd>get the <b>total</b> number of children under this node and all
						of it's children.</dd>

					<dt>getChildIds()</dt>
						<dd>Return the IDs of all the leaves under this branch (recursively)</dd>

					<dt>getChildNo()</dt>
						<dd>Get the position of this node in it's parents children
						array</dd>

					<dt>getChildYTotal()</dt>
						<dd>Return the total distance on the Y axis occupied by this nodes children</dd>

					<dt>getLabel()</dt>
						<dd>return the text that labels this node, if no label is
						set return the node id</dd>

					<dt>getLabelSize()</dt>
						<dd>Return the width of this node's label</dd>

					<dt>getNodeSize()</dt>
						<dd>Get the size of the tip of the node</dd>

					<dt>getNWK()</dt>
						<dd>Return the nwk format string of this node</dd>

					<dt>getTextColour()</dt>
						<dd>Get the colour of the label</dd>

					<dt>parseNwk(nwk_string, idx)</dt>
						<dd>recursive parsing function for a nwk file</dd>

					<dt>parseLabel(nwk_string, idx)</dt>
						<dd>parse a label from a nwk string</dd>

					<dt>parseNodeLength(nwk_string, idx)</dt>
						<dd>Parse the node length from a nwk string</dd>

					<dt>redrawTreeFromBranch()</dt>
						<dd>Draw a subtree from this branch</dd>

					<dt>reset()</dt>
						<dd>set all the branches positional properties back to 0 ready for the
						next branch layout</dd>

					<dt>rotate()</dt>
						<dd>Reverse the order of the nodes immediate children. The reverse function is available in the right-click menu</dd>

					<dt>saveChildren()</dt>
						<dd>save this nodes children to the tree</dd>

					<dt>setHighlighted(highlighted)</dt>
						<dd>Sets whether or not this branch is highlighted (true or false)</dd>

					<dt>setSelected(<i>selected</i>, <i>applyToChildren</i>)</dt>
						<dd>Set whether the node is selected (true or false) and whether
						this should be applied to all it's children.</dd>


					<dt>setTotalBranchLength()</dt>
						<dd>calculate the total branch length property for this node</dd>

					<dt>toggleCollapse()</dt>
						<dd>Toggle this node between collapsed and expanded</dd>

			</section>

			<section>
				<h2>PhyloCanvas.History</h2>
				<p>The history panel of sub-trees
				<h3>Properties</h3>
				<dl>
					<dt>tree</dt>
						<dd>reference to the tree object</dd>

					<dt>div</dt>
						<dd>the dive containing the history</dd>
				</dl>

				<h3>Functions</h3>
				<dl>
					<dt>reset()</dt>
						<dd>Clear all the snapshots and then add the root snapshot</dd>

					<dt>collapse()</dt>
						<dd>Collapse the histroy panel into the left of the PhyloCanvas
							div</dd>

					<dt>expand()</dt>
						<dd>Show the History</dd>

					<dt>isCollapsed()</dt>
						<dd>return true if the history is collapsed and false if it isn't</dd>

					<dt>toggle()</dt>
						<dd>If the history is collapsed exapand it and vice-versa</dd>

					<dt>createDiv(parentDiv)</dt>
						<dd>Crete the div that will contain the history</dd>

					<dt>resizeTree()</dt>
						<dd>Adjust the size of the tree to compensate for the History being
						collapsed or expanded</dd>

					<dt>addSnapshot(id)</dt>
						<dd>Add a snapshot of the current tree view that will redraw the
							tree from the node with the ID id.</dd>

					<dt>clear()</dt>
						<dd>Remove all the snapshots</dd>

					<dt>goBackTo(event)</dt>
						<dd>Click handler for the snapshots that removes the subsequent
						history entries.</dd>
				</dl>
			</section>

			<section>
				<h2>PhyloCanvas.History</h2>
				<p>The history panel of sub-trees
				<h3>Properties</h3>
				<dl>
					<dt>tree</dt>
						<dd>reference to the tree object</dd>

					<dt>div</dt>
						<dd>the dive containing the history</dd>

					<dt>elements</dt>
						<dd>Menu choices, an array of dictionaries with properties
							<dl class="arguments">
								<dt>text</dt>
									<dd>The label of the menu item</dd>

								<dt>handler</dt>
									<dd>The function in the Tree object that the menu item invokes. If
									a node has been clicked on it is padded to the handler</dd>

								<dt>internal</dt>
									<dd>Does this function apply to an internal node</dd>

								<dt>leaf</dt>
									<dd>Does this function apply to a leaf</dd>
							</dl>
						</dd>
				</dl>

				<h3>Functions</h3>
				<dl>
					<dt>close()</dt>
						<dd>close the context menu</dd>

					<dt>mouseover</dt>
					<dt>mouseout</dt>
						<dd>hover functions</dd>

					<dt>open(x,y)</dt>
						<dd>Open the menu at position x,y</dd>
				</dl>
			</section>
			<hr />
		</div>
	</body>
</html>
